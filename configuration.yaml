# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

homeassistant:
  customize: !include customize.yaml

# reduce login failure messages
http:
  use_x_forwarded_for: true
  trusted_proxies:
    - 127.0.0.1
    - 172.16.0.0/12

history: !include history.yaml
frontend: !include themes.yaml
group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml
alexa: !include alexa.yaml
camera: !include camera.yaml
switch: !include switch.yaml
light: !include light.yaml
wake_on_lan:

# prevent lag and spam
logbook:
  exclude:
    domains:
      - input_number
      - binary_sensor
      - input_boolean
      - automation
      - media_player
      - group

#reduce db size
recorder:
  purge_keep_days: 3

# to track dlink errors
system_log:
  fire_event: true

spotify: # still required for ui integration
  client_id: !secret spotify_id
  client_secret: !secret spotify_secret

media_player:
  - platform: androidtv
    name: Bedroom Fire TV Stick
    host: !secret bedroom_fire_tv
    screencap: false
    apps:
      "com.stealth.stealthiptvbox": "Stealth"
  - platform: androidtv
    name: Living Room Fire TV Stick
    host: !secret living_room_fire_tv
    screencap: false
    apps:
      "com.stealth.stealthiptvbox": "Stealth"

binary_sensor:
  - platform: dlink_hnap
    name: Bedroom Motion Sensor
    host: !secret bedroom_motion_sensor
    type: motion
    password: !secret motion_sensor_pin
  - platform: dlink_hnap
    name: Bedroom Motion Sensor 2
    host: !secret bedroom_motion_sensor_2
    type: motion
    password: !secret motion_sensor_2_pin
  - platform: wyzesense
    device: auto

sensor:
  - platform: template
    sensors:
      bed_motion_battery:
        friendly_name: 'Bed Motion Battery'
        value_template: '{{ state_attr("binary_sensor.wyzemotion","battery_level") }}'
        unit_of_measurement: '%'
        device_class: battery
      bedroom_door_battery:
        friendly_name: 'Bedroom Door Sensor Battery'
        value_template: '{{ state_attr("binary_sensor.bedroom_door","battery_level") }}'
        unit_of_measurement: '%'
        device_class: battery
      window_sensor_battery:
        friendly_name: 'Window Sensor Battery'
        value_template: '{{ state_attr("binary_sensor.window","battery_level") }}'
        unit_of_measurement: '%'
        device_class: battery
      dark_outside:
        friendly_name: "Dark Outside"
        value_template: >
          {{ state_attr("sun.sun","elevation")|float < 3
          or (state_attr("sun.sun","elevation")|float < 4.5 and states("sensor.home_cloud_cover")|float > 80)
          or (state_attr("sun.sun","elevation")|float < 6.5 and states("sensor.home_cloud_cover")|float > 85)
          or (states("sensor.home_cloud_cover")|float > 90) }}

shell_command:
  pc_on: !secret windows_on
  pc_off: !secret windows_off