- binary_sensor:
  - name: "Discord Active"
    state: >
      {{ states('sensor.discord')|float(-1) > 0}}
  - name: "Bedroom On"
    state: >
      {{ is_state('light.bedroom_lights', 'on') }}
- sensor:
  - name: "AC Thermostat Temperature"
    state: >
      {% if is_state("input_boolean.ac_boost", "on") -%} 61 
      {% elif is_state("binary_sensor.bedroom_door", "on") -%} 76
      {% elif is_state("switch.desktop", "on") -%} 75
      {% elif is_state("light.fan_lights", "on") -%} 73 
      {%- else -%} 71
      {%- endif %}
  - name: "Alarm Display"
    state: >
      {% if states.sensor.bedroom_dot_next_alarm.state == "unavailable" -%} 0
      {% elif as_datetime(states.sensor.bedroom_dot_next_alarm.state).day - now().day > 1 -%} 0
      {% elif as_datetime(states.sensor.bedroom_dot_next_alarm.state).day != now().day -%}
      {{ (as_datetime(states.sensor.bedroom_dot_next_alarm.state).strftime("%s") | int) | timestamp_custom("%A at %-I:%M %p", false) }}
      {%- else -%} 
      {{ (as_datetime(states.sensor.bedroom_dot_next_alarm.state).strftime("%s") | int) | timestamp_custom("%-I:%M %p", false) }}
      {%- endif %}
  - name: "Nanoleaf Auto-Brightness"
    state: >
      {# Off #}
      {% if is_state("light.bedroom_lights", "off") -%} 0
      {# In call with color loop #}
      {% elif is_state("switch.desktop", "on") and 
      is_state("binary_sensor.webcam", "on") and 
      is_state_attr("light.fan_lights", "Effect", "Color") -%} 137
      {# In call with lights white #}
      {% elif is_state("switch.desktop", "on") and
      is_state("binary_sensor.webcam", "on") and
      is_state("light.fan_lights", "on") -%} 175
      {# Door opened #}
      {% elif is_state("binary_sensor.bedroom_door", "on") -%} 254
      {# At desk with lights on #}
      {% elif is_state("switch.desktop", "on") and 
      is_state("light.fan_lights", "on") -%} 153
      {# At desk with lights off #}
      {% elif is_state("switch.desktop", "on") -%} 102
      {# Night call #}
      {% elif state_attr('light.bed_lights', 'rgb_color')
      | join(' ') == "0 255 255" and 
      is_state_attr("light.bed_lights", "effect", "None")%} 25
      {# Normal #}
      {% elif is_state("light.fan_lights", "on") -%} 254
      {# In bed #}
      {% elif is_state("light.bedroom_lights", "on") -%} 63
      {%- else -%} 0
      {%- endif %} 
- trigger:
  - platform: time_pattern
    seconds: /3
  sensor:
    - name: colorloopstate
      state: >
        {% if states('sensor.colorloopstate')|int(0) == 4 %} 0
        {% else %} {{ states('sensor.colorloopstate')|int(0) + 1 }}
        {% endif %}
- trigger:
  - platform: time_pattern
    minutes: /30
  - platform: state
    entity_id:
      - binary_sensor.webcam
  - platform: state
    entity_id:
      - light.shapes_007f
    from: "off"
    to: "on"
  - platform: state
    entity_id:
      - media_player.spotify_anthony221121
    to: "playing"
  - platform: state
    entity_id:
      - media_player.spotify_anthony221121
    to: "idle"
  - platform: state
    entity_id:
      - media_player.spotify_anthony221121
    to: "paused"
  - platform: state
    entity_id:
      - media_player.spotify_anthony221121
    attribute: media_playlist
  sensor:
    - name: "Nanoleaf Scene"
      state: >
        {# Off #}
        {% if is_state("light.bedroom_lights", "off") -%}
        {% set scenes = "unknown" %}
        {# In call #}
        {% elif is_state("binary_sensor.webcam", "on") -%}
        {% set scenes = "Webcam" %}
        {# Music #}
        {% elif is_state("media_player.spotify_anthony221121", "playing") -%} 
        {% set scenes = ['Shooting Stars', 'Cotton Candy', 'Pop Rocks',
        'Rhythmic Northern Lights', 'Meteor Shower', "Soda", 
        'Pulse Pop Beats', 'Energize', 'Electric purple', 'Mood Movie', 
        'Water Cooler', 'Clubbing', 'Snowy Holiday', 'Lofi Sound'] | 
        reject('in', [state_attr('light.shapes_007f', "effect")]) | list %}
        {% if not is_state_attr("media_player.spotify_anthony221121", 
        "media_playlist", "lofi hip hop music - beats to relax/study to") -%} 
        {% set scenes = scenes + ['cool thing', 'Hip Hop', 'Prism',
        'Tachyon Light2', 'Oceanworks'] %} {%- endif %}  
        {% else %} {# Normal #}
        {% set scenes = ['Cosmos', 'Dynamic Blue', 'Ocean', 
        'Vaporwave', 'Rainbow', 'energy'] | 
        reject('in', [state_attr('light.shapes_007f', "effect")]) | list %}
        {% if now().hour < 7 and 
        is_state("switch.desktop", "off") %}  {% set scenes = scenes + 
        ['moonlight', 'Lightscape', 'Night light', 'Tron Legacy',
        'Pink To Blue', 'Rain', 'TRON CITY', 'Waterfall', 
        'Playstation Blue', 'Bedtime', 'Aurora magic', 'Holodek'] %}
        {%- endif %}  
        {%- endif %} 
        {{ scenes | random }}